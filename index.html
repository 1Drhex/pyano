<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Piano Generator with Shifting</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex flex-col items-center p-6 space-y-6">

  <h1 class="text-2xl font-bold">üéπ Piano Key Highlighter</h1>

  <!-- Canvas -->
  <canvas id="piano" width="1120" height="200" class="border rounded shadow-lg bg-white"></canvas>

  <!-- Controls -->
  <div id="controls" class="w-full max-w-5xl flex flex-wrap gap-4 justify-center"></div>

  <!-- Interval Shift -->
  <div class="flex items-center gap-2">
    <label class="font-medium">Shift by semitones:</label>
    <input id="shiftAmount" type="number" value="1" min="-12" max="12" class="w-16 border rounded px-2 py-1 text-center">
    <button id="shiftBtn" 
            class="px-3 py-1 bg-green-600 text-white rounded-lg shadow hover:bg-green-700">
      üîÄ Shift Colors
    </button>
  </div>

  <!-- Download -->
  <button id="downloadBtn" 
          class="px-4 py-2 bg-blue-600 text-white font-medium rounded-lg shadow hover:bg-blue-700">
    ‚¨áÔ∏è Download Piano Image
  </button>

<script>
function drawPiano(canvasId, numOctaves = 4, highlight = {}, showLabels = true) {
  const whiteKeyWidth = 40;
  const whiteKeyHeight = 200;
  const blackKeyWidth = 25;
  const blackKeyHeight = 120;

  const whiteKeyNames = ["C", "D", "E", "F", "G", "A", "B"];
  const blackKeyNames = ["C#", "D#", "F#", "G#", "A#"];
  const blackKeyOffsets = [0.7, 1.7, 3.7, 4.7, 5.7];

  const canvas = document.getElementById(canvasId);
  const ctx = canvas.getContext("2d");

  let whiteIndex = 0;
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // White keys
  for (let octave = 1; octave <= numOctaves; octave++) {
    for (let i = 0; i < whiteKeyNames.length; i++) {
      const note = whiteKeyNames[i] + octave;
      const x = whiteIndex * whiteKeyWidth;
      ctx.fillStyle = highlight[note] || "white";
      ctx.fillRect(x, 0, whiteKeyWidth, whiteKeyHeight);
      ctx.strokeRect(x, 0, whiteKeyWidth, whiteKeyHeight);

      if (showLabels) {
        ctx.fillStyle = "black";
        ctx.font = "12px Arial";
        ctx.textAlign = "center";
        ctx.fillText(note, x + whiteKeyWidth / 2, whiteKeyHeight - 10);
      }

      whiteIndex++;
    }
  }

  // Black keys
  for (let octave = 1; octave <= numOctaves; octave++) {
    for (let i = 0; i < blackKeyNames.length; i++) {
      const note = blackKeyNames[i] + octave;
      const x = ((octave - 1) * 7 + blackKeyOffsets[i]) * whiteKeyWidth;
      ctx.fillStyle = highlight[note] || "black";
      ctx.fillRect(x, 0, blackKeyWidth, blackKeyHeight);
      ctx.strokeRect(x, 0, blackKeyWidth, blackKeyHeight);

      if (showLabels) {
        ctx.fillStyle = "white";
        ctx.font = "10px Arial";
        ctx.textAlign = "center";
        ctx.fillText(note, x + blackKeyWidth / 2, blackKeyHeight - 5);
      }
    }
  }
}

// -------- NOTE SYSTEM --------
const chromatic = ["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
function noteToIndex(note) {
  return chromatic.indexOf(note.replace(/[0-9]/g, ""));
}
function shiftNote(note, shift) {
  const octave = parseInt(note.replace(/[^0-9]/g, ""), 10);
  const base = note.replace(/[0-9]/g, "");
  let idx = (noteToIndex(base) + shift + 12) % 12;
  let newOctave = octave + Math.floor((noteToIndex(base) + shift) / 12);
  return chromatic[idx] + newOctave;
}

// -------- INTERACTIVE UI --------
const notes = [];
for (let octave = 1; octave <= 4; octave++) {
  chromatic.forEach(n => notes.push(n + octave));
}

let highlight = {};
const controlsDiv = document.getElementById("controls");

// Build color pickers
const inputs = {};
notes.forEach(note => {
  const wrapper = document.createElement("div");
  wrapper.className = "flex flex-col items-center";

  const input = document.createElement("input");
  input.type = "color";
  input.value = (note.includes("#")) ? "#000000" : "#ffffff";
  input.className = "w-12 h-12 border rounded cursor-pointer";

  input.addEventListener("input", () => {
    highlight[note] = input.value;
    drawPiano("piano", 4, highlight, true);
  });

  const label = document.createElement("label");
  label.innerText = note;
  label.className = "text-xs mt-1";

  wrapper.appendChild(input);
  wrapper.appendChild(label);
  controlsDiv.appendChild(wrapper);
  inputs[note] = input;
});

// Initial draw
drawPiano("piano", 4, highlight, true);

// Shift colors
document.getElementById("shiftBtn").addEventListener("click", () => {
  const amount = parseInt(document.getElementById("shiftAmount").value, 10) || 0;
  let newHighlight = {};
  for (let note in highlight) {
    newHighlight[shiftNote(note, amount)] = highlight[note];
  }
  highlight = newHighlight;

  // Update pickers too
  for (let note in inputs) {
    inputs[note].value = highlight[note] || (note.includes("#") ? "#000000" : "#ffffff");
  }

  drawPiano("piano", 4, highlight, true);
});

// Download
document.getElementById("downloadBtn").addEventListener("click", () => {
  const canvas = document.getElementById("piano");
  const link = document.createElement("a");
  link.download = "piano.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
});
</script>
</body>
</html>
